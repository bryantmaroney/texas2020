window.Dots={dotsContainer:document.querySelectorAll(".desktop-dots"),modalItems:document.querySelectorAll(".vote-item"),maxAllow:15,baseUrl:`${window.location.origin}${window.location.pathname}`,checkCount:function(){return Math.floor(document.querySelectorAll(".owl-item").length/3)>=11?11:10},onLoad:function(){this.setVariables(),11!=Dots.checkCount()&&(this.dots[0].classList.add("selected-dot"),this.mobileDots[0].classList.add("selected-dot")),this.onClickDots(),this.checkTime(),this.setDots(),this.bindEvent(),this.checkResetButton()},checkResetButton:function(){var e=JSON.parse(localStorage.voteResult||"[]"),t=document.querySelectorAll(".resetVoteAnswers");Object.values(t).forEach(t=>{t.style.display=e.length?"inline":"none"})},post:function(e,t){var s,o=(new Headers).append("Content-Type","application/x-www-form-urlencoded"),a=new URLSearchParams;for(key in e)a.append(key,e[key]);return s={method:"POST",headers:o,body:a,redirect:"follow"},new Promise((e,o)=>{fetch(`${this.baseUrl}${t}`,s).then(e=>e.text()).then(t=>e(t)).catch(e=>o("error",e))})},setScripts:function(){},setVariables:function(){this.dots=document.querySelectorAll(".desktop-dots")[1].children,this.mobileDots=document.querySelectorAll(".desktop-dots")[0].children},setDots:function(){let e=JSON.parse(localStorage.getItem("voteResult"))||[];e.forEach(e=>{e&&(document.querySelector(`[data-desk-name=${Object.keys(e)[0]}]`).classList.add(Object.values(e)[0]),document.querySelector(`[data-mobile-name=${Object.keys(e)[0]}]`).classList.add(Object.values(e)[0]))}),10===e.filter(e=>e).length&&this.appendSummaryLink()},setActive:e=>{e--,document.querySelectorAll(".selected-dot").length&&document.querySelectorAll(".selected-dot").forEach(e=>e.classList.remove("selected-dot")),!Dots.dots&&Dots.setVariables(),Dots.dots[e]&&Dots.dots[e].classList.add("selected-dot"),Dots.mobileDots[e]&&Dots.mobileDots[e].classList.add("selected-dot")},setStorageData:function(e,t){let s={},o=JSON.parse(localStorage.getItem("voteResult")||"[]"),a=Object.values(this.dots).findIndex(t=>t.children[0].getAttribute("data-desk-name")===e);s[e]=t,o[a]=s,localStorage.setItem("voteResult",JSON.stringify(o)),10===o.filter(e=>e).length&&(!localStorage.answerTime&&localStorage.setItem("answerTime",(new Date).getTime()),this.appendSummaryLink(),this.modalAction("open"),this.createImage())},createImage:async function(){var e;this.mToImg=this.mToImg?this.mToImg:new ModalToImage(5);try{e=await this.mToImg.createImage(),data=await this.post({base64:e},"save-vote-img"),data=JSON.parse(data),document.getElementById("voteIndex").dataset.id=data.indexName}catch(e){console.log(e)}},checkTime:function(){var e=(new Date).getTime();(e-(+localStorage.answerTime||e))/6e4>=this.maxAllow&&(localStorage.setItem("voteResult","[]"),localStorage.removeItem("answerTime"),this.cleareDotsClases())},cleareDotsClases:function(){Object.values(this.dots).forEach((e,t)=>{e.children[0]&&(e.children[0].className=""),Object.values(this.mobileDots)[t]&&(Object.values(this.mobileDots)[t].children[0].className="")}),this.checkResetButton(),document.querySelectorAll(".desktop-dots")[0]&&document.querySelectorAll(".desktop-dots")[0].nextElementSibling&&document.querySelectorAll(".desktop-dots")[0].nextElementSibling.remove(),document.querySelectorAll(".desktop-dots")[1]&&document.querySelectorAll(".desktop-dots")[1].nextElementSibling&&document.querySelectorAll(".desktop-dots")[1].nextElementSibling.remove()},userVote:function(e,t){let s={agree:"agree-dot",disagree:"disagree-dot",skip:"skip-dot"},o=[document.querySelector(`[data-desk-name="${t}"]`),document.querySelector(`[data-mobile-name="${t}"]`)];this.checkTime(),this.setStorageData(t,s[e]),this.checkResetButton(),o[0].classList.remove(...o[0].classList),o[1].classList.remove(...o[1].classList),o[0].classList.add(s[e]),o[1].classList.add(s[e])},appendSummaryLink:function(){let e=jQuery(`\n            <div class="summary-container">\n                <img src="${site_url}assets/images/summaryIcon.png" alt="">\n                <span id="openSummaryModal">View My Results</span>\n            </div>\n        `);jQuery(".summary-container").length||jQuery(this.dotsContainer).after(e)},modalAction:function(e){let t,s,o=JSON.parse(localStorage.voteResult),a={"agree-dot":{img:"summary-agree.png",color:"#00A200"},"disagree-dot":{img:"summary-disagree.png",color:"#D50008"},"skip-dot":{img:"summary-skip.png",color:"#778AA8"}};"flex"===(e="open"===e?"flex":"none")&&this.modalItems.forEach((e,l)=>{t=e.querySelector("img"),"skip-dot"!==Object.values(o[l])[0]?(t.parentNode.children[1]&&t.parentNode.children[1].remove(),t.style.display="inline",t.setAttribute("src",`assets/images/${a[Object.values(o[l])[0]].img}`)):((s=document.createElement("span")).innerText="N/A",s.style.marginLeft=0,t.style.display="none",t.parentNode.children[1]&&t.parentNode.children[1].remove(),t.parentNode.appendChild(s)),t.parentNode.style.backgroundColor=a[Object.values(o[l])[0]].color}),document.getElementById("summaryModal").style.display=e},changeSlide:function(e,t){let s=jQuery(`#${t}`).owlCarousel();e=11===this.checkCount()?e:e-1,s.trigger("to.owl.carousel",[e,500])},onClickDots:function(){var e=["EndGerrymandering","VoteByMail","RevealtheWriters","ModernizeElections","RCV","BantheBarriers","LimittheLobbyists","RethinkRegistration","CleanUpElections","TuneinTexas","LearnYourDistricts"];Object.values(this.dots).forEach(e=>{e.addEventListener("click",e=>{this.changeSlide(+e.currentTarget.getAttribute("data-id"),"carusel-desktop")})}),Object.values(this.mobileDots).forEach(e=>{e.addEventListener("click",e=>{this.changeSlide(+e.currentTarget.getAttribute("data-id"),"carusel-mobile")})}),localStorage.url&&-1!==e.indexOf(localStorage.url)&&(Object.values(this.mobileDots)[e.indexOf(localStorage.url)].click(),Object.values(this.dots)[e.indexOf(localStorage.url)].click(),localStorage.removeItem("url"))},resetAnswers:function(){var e=document.querySelectorAll(".selectedAnswer");Object.values(e).forEach(e=>{e.className=e.className.replace(/[ ].+/g,"")}),localStorage.voteResult="[]",this.cleareDotsClases()},bindEvent:function(){var e={resetAnswers:{element:"resetVoteAnswers"}};document.addEventListener("click",t=>{for(let s in e)t.target.classList.contains(e[s].element)&&Dots[s].call(Dots)})}},jQuery(document).ready(function(){setTimeout(()=>{Dots.onLoad()})});